name: Test check run

on:
  check_run:
    types: [completed]

jobs:
  test-check-run:
    runs-on: ubuntu-latest
    if: ${{ github.event.check_run.conclusion == 'success' && (github.event.check_run.name ==  '[test1] Build' || github.event.check_run.name ==  '[test2] Build') }}
    steps:
      - name: Get app name
        id: get-app-name
        run: |
          string="${{ github.event.check_run.name }}"
          pattern='\[(.*)\] Build'
          if [[ $string =~ $pattern ]]; then
            echo "app_name=${BASH_REMATCH[1]}" >> "$GITHUB_OUTPUT"
          fi
      
      - name: Debug context values
        run: |
          echo "Nom du check run re√ßu : ${{ github.event.check_run.name }}"
          echo "Nom attendu pour ce job : [${{ steps.get-app-name.outputs.app_name }}] Build"
          echo "Nom commit github : ${{ github.sha }}"
          echo "Nom commit check_run : ${{ github.event.check_run.head_sha }}"
